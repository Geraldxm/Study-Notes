图片生成模型的思路，抽象出过程就是将训练样本分布 (也就是图片) 映射到另一个分布 (如正态分布噪声)，推理过程就是从新分布中采样映射回原分布。

**生成模型的难题就是判断生成分布与真实分布的相似度，因为我们只知道两者的采样结果，不知道它们的分布表达式。**

[变分自编码器VAE - 知乎 (zhihu.com)](https://zhuanlan.zhihu.com/p/635826906)

[变分自编码器VAE：原来是这么一回事 | 附开源代码 - 知乎 (zhihu.com)](https://zhuanlan.zhihu.com/p/34998569)

[从VAE到Diffusion Model：生成式模型初探 - 知乎 (zhihu.com)](https://zhuanlan.zhihu.com/p/659566348)

# VAE - 变分自编码器

Variational Auto-Encoder，变分自(动)编码器。

最终目的！产生与训练样本**同分布**但是没有出现过 (不一样) 的新样本。

## 思考过程

我们有一组数据样本 ${x_i}$ ，如果能根据这组样本得到其概率分布 $p(X)$ ，那么我们直接可以对 $p(X)$ 进行采样，这样就能得到所有的 $X$ ，包括在我们已有数据集之外的内容。

退而求其次，我们可以很容易有一个标准正态分布 $Z$ ，以及其概率分布 $p(Z)$ ，那么如果满足如下条件：
$$
p(X)=\sum_{Z}{p(X|Z)p(Z)}
$$
那么我们可以采样一个 $z$ ，然后得到 $x$ ，也能生成。

我们需要解决一个问题，重新采样生成的 $\hat{X_k}$ 与原来的 $X_k$ 是否对应，能否直接最小化 $D(\hat{X_k},X_k)$ ？我们需要找一个合适的度量，要确认一致。

	WGAN 的思路是，干脆使用神经网络训练这个度量。

## VAE 浮现

具体来说，给定一个真实样本 $x_k$ ，我们假设存在一个专属于 $x_k$ 的分布 $p(Z|x_k)$ ，并进一步假设这个分布是（独立的、多元的）正态分布。

我们还会训练一个生成器 $X=g(Z)$ ，希望能把分布 $p(Z|x_k)$ 中采样的一个 $z_k$ 还原为 $x_k$ 。

如果直接假设 $p(Z)$ 是正态分布，然后从中采样 $z_k$ ，很难对应到原来的真实 $x_k$ 。但是现在 $p(Z|x_k)$ 专属于 $x_k$ ，可以说从中采样出来的 $z_k$ 应该还原到 $x_k$ 中去。

如何得到 $p(Z|x_k)$ 这一个正态分布的均值和方差？粗暴的思路就是使用神经网络来拟合。

 构建两个神经网络 $\mu_k = f_1(x_k)$ ， $log {\sigma^2}=f_2(x_k)$ 。用 log 拟合的原因是 log 可正可负，而 $\sigma^2$ 总是非负的。

得到均值和方差后，就得到了这个正态分布，然后可以采样 $z_k$ ，经过一个生成器得到 $\hat{x}_k=g(z_k)$ 

现在可以进行最小化 $D^2(\hat{x}_k,x_k)$ 的操作。

![VAE结构示意图](https://pic1.zhimg.com/80/v2-36c7da0b2fe37bd021699532a2cff1e8_1440w.webp)

## 分布标准化

我们希望最小化 $D^2(\hat{x}_k,x_k)$ ，而重构得到 $z_k$ 会受到噪声的影响，因此神经网络可能会尽可能让方差为 0，但这样就会丧失随机性。

因此 VAE 希望所有的 $p(Z|X)$ 贴近标准正态分布，可以防止噪声为 0。

![](https://pic3.zhimg.com/80/v2-a3f264a40db57e010b7ebf0253198726_1440w.webp)

如何实现向 $\mathcal{N}(0,1)$ 看齐呢？最直接的方法就是加入loss
$$
\mathcal{L}_u=||f_1(X_k)||^2 \space和 \space\mathcal{L}_{log_{\sigma^2}}=||f_2(X_k)||^2
\tag{3}
$$

此时只要希望两者接近 0 即可。

两个 loss 需要调整合适的比例。作者通过添加另一个 loss，来避免比例的问题。

	计算了一般正态分布与标准正态分布的KL散度

![](https://pic4.zhimg.com/80/v2-af1049578e84eddf1c817422aa8a3bbf_1440w.webp)

![推导过程](https://pic3.zhimg.com/80/v2-7a3c7ea64e7f11c475cf35cd44fa3ca2_1440w.webp)

## 重参数技巧

我们希望所有的 $p(Z|X)$ 贴近标准正态分布。采样过程不可导，采样结果可导，通过参数变换，使采样的结果能够参与模型训练。

![](https://pic1.zhimg.com/80/v2-39d484abe79242a398d6f57ee3d7dc04_1440w.webp)



# GAN - 生成式对抗神经网络

[PaperWeekly 第41期 | 互怼的艺术：从零直达 WGAN-GP (qq.com)](https://mp.weixin.qq.com/s?__biz=MzIwMTc4ODE0Mw==&mid=2247484880&idx=1&sn=4b2e976cc715c9fe2d022ff6923879a8&chksm=96e9da50a19e5346307b54f5ce172e355ccaba890aa157ce50fda68eeaccba6ea05425f6ad76&scene=21#wechat_redirect)

